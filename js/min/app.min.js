function loadError(e){alert(e+" could not be initialized.")}function populateInfoWindow(e,t){function o(o,i){if(i==google.maps.StreetViewStatus.OK){var a=o.location.latLng,n=google.maps.geometry.spherical.computeHeading(a,e.position);t.setContent('<div id="iw-title">'+e.title+" "+e.rating+" "+e.phone+'</div><div id="pano"></div>'),google.maps.event.addListener(t,"domready",function(){var e=$(".gm-style-iw"),t=e.prev();t.children(":nth-child(2)").css({display:"none"}),t.children(":nth-child(4)").css({display:"none"});var o=e.next();o.css({opacity:"1",border:"7px solid #48b5e9","border-radius":"13px","box-shadow":"0 0 5px #3990B9"}),o.mouseout(function(){$(this).css({opacity:"1"})})});var s={position:a,pov:{heading:n,pitch:0}};new google.maps.StreetViewPanorama(document.getElementById("pano"),s)}else t.setContent("<div>"+e.title+"</div><div>No Street View Found</div>")}if(t.marker!=e){t.setContent(""),t.marker=e,t.addListener("closeclick",function(){t.marker=null}),null!==e.getAnimation()?e.setAnimation(null):(e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},2850));(new google.maps.StreetViewService).getPanoramaByLocation(e.position,500,o),t.open(map,e)}}function showRicksHood(){for(var e=new google.maps.LatLngBounds,t=0;t<markers.length;t++)markers[t].setMap(map),markers[t].setVisible(!0),e.extend(markers[t].position);map.fitBounds(e)}function hideRicksHood(){for(var e=0;e<markers.length;e++)markers[e].setMap(null)}function pad(e){return e<10?"0"+e:e}function showSearchResults(e,t){var o=(new Date).getFullYear().toString()+pad(((new Date).getMonth()+1).toString())+pad((new Date).getDate().toString()),i="https://api.foursquare.com/v2/venues/search?categoryID=&client_id="+clientID+"&client_secret="+secret+"&v="+o+"&ll=32.01,-102.10&query="+t();$.getJSON(i,function(t){var o=t.response.venues,i=locationsLength;for(o.forEach(function(t){try{t.categories[0].icon&&(imgPrefix=t.categories[0].icon.prefix,imgSuffix=t.categories[0].icon.suffix,imgSize="32",t.imgURL=imgPrefix+imgSize+imgSuffix)}catch(e){t.imgURL="https://ss3.4sqi.net/img/categories_v2/building/default_32.png"}t.filterID=i,i++,e.push(t)}),i=0;i<o.length;i++){var a=parseFloat(o[i].location.lat),n=parseFloat(o[i].location.lng),s=o[i].name,r=o[i].contact.formattedPhone;r||(r="unavailable");var l=new google.maps.Marker({position:{lat:a,lng:n},title:s,animation:google.maps.Animation.DROP,id:i,rating:"",phone:"<p> Phone: "+r+"<p>"});e()[i+locationsLength].marker=l,markers.push(l),markers[i].setVisible(!0),null!==l.getAnimation()?l.setAnimation(null):(l.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){l.setAnimation(null)},3e3)),largeInfowindow=new google.maps.InfoWindow,l.addListener("click",function(){populateInfoWindow(this,largeInfowindow)}),showRicksHood()}}).fail(function(e){alert("Foursquare data failed to load.  Error : "+e.status),showRicksHood()})}function makeMarkerIcon(e){return new google.maps.MarkerImage("http://chart.googleapis.com/chart?chst=d_map_spin&chld=1.15|0|"+e+"|40|_|%E2%80%A2",new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34),new google.maps.Size(21,34))}var imgURL,filterID,map,locationsLength,markers=[],clientID="QU01LFBIGT44FNACHRMVI1FCKBNE5LH25D2MDJS4ESIOOFLW",secret="B4MK0Z5OWO1CSIIE5WEJCJHILJ13LJIKS5H20PHZTBLR44S5",locations=[{title:"Ricks Home",location:{lat:32.010396,lng:-102.107679},content:"Rick has a nice house.",imgURL:"https://ss3.4sqi.net/img/categories_v2/arts_entertainment/arcade_32.png",rating:"✨✨✨✨✨",phone:"(432) 664-5266"},{title:"Fasken Park",location:{lat:32.012297,lng:-102.106606},content:"Faskin Park is a nice place for a picnic.",imgURL:"https://ss3.4sqi.net/img/categories_v2/parks_outdoors/park_32.png",rating:"✨✨✨✨✨",phone:"unavailable"},{title:"Midland College",location:{lat:32.030844,lng:-102.106315},content:"Rick went to school here.",imgURL:"https://ss3.4sqi.net/img/categories_v2/education/other_32.png",rating:"✨✨✨✨✨",phone:"(432) 685-4500"},{title:"Matthew's Martial Arts",location:{lat:31.998896,lng:-102.1163},content:"This is where we study mixed martial arts.",imgURL:"https://ss3.4sqi.net/img/categories_v2/shops/gym_martialarts_32.png",rating:"✨✨✨✨✨",phone:"(432) 488-7467"},{title:"Dog Park",location:{lat:32.036648,lng:-102.072355},content:"A great place to play frisbee with pets.",imgURL:"https://ss3.4sqi.net/img/categories_v2/parks_outdoors/dogrun_32.png",rating:"✨✨✨✨✨",phone:"Phones for dogs?!"}];$("#menu-toggle").click(function(e){e.preventDefault(),$("#wrapper").toggleClass("toggled")});var AppViewModel=function(){var e=this;this.searchForName=ko.observable(""),this.filter=ko.observable(""),this.ricksPlaces=ko.observableArray(),this.filterResults=ko.computed(function(){var t=[],o=e.filter().toLowerCase();if(!o){for(i=0;i<e.ricksPlaces().length;i++)markers[i]&&markers[i].setVisible(!0);return e.ricksPlaces()}return e.ricksPlaces().forEach(function(e){e.name.toLowerCase().indexOf(o)!==-1?(t.push(e),markers[e.filterID]&&markers[e.filterID].setVisible(!0)):(markers[e.filterID]&&markers[e.filterID].setVisible(!1),largeInfowindow.close())}),t}),this.newSearch=function(t){if(this.ricksPlaces([]),e.filter.valueHasMutated(),locationsLength=0,markers.length>0){for(i=0;i<markers.length;i++)markers[i].setMap(null);markers=[]}showSearchResults(e.ricksPlaces,t)},showInfo=function(){populateInfoWindow(this.marker,largeInfowindow)}};AppViewModel.prototype.initMap=function(){var e=new google.maps.StyledMapType([{featureType:"water",stylers:[{color:"#19a0d8"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"},{weight:6}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#e85113"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#efe9e4"},{lightness:-40}]},{featureType:"transit.station",stylers:[{weight:9},{hue:"#e85113"}]},{featureType:"road.highway",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{lightness:100}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{lightness:-100}]},{featureType:"poi",elementType:"geometry",stylers:[{visibility:"on"},{color:"#f0e4d3"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#efe9e4"},{lightness:-25}]}],{name:"Desert Map"}),t=new google.maps.StyledMapType([{featureType:"all",elementType:"labels.text.fill",stylers:[{color:"#ffffff"}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{color:"#000000"},{lightness:13}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#000000"}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#144b53"},{lightness:14},{weight:1.4}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#08304b"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#0c4152"},{lightness:5}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#000000"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#0b434f"},{lightness:25}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#000000"}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{color:"#0b3d51"},{lightness:16}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#000000"}]},{featureType:"transit",elementType:"all",stylers:[{color:"#146474"}]},{featureType:"water",elementType:"all",stylers:[{color:"#021019"}]}],{name:"Midnight Map"}),o=this;map=new google.maps.Map(document.getElementById("map"),{center:{lat:32.010394,lng:-102.107687},zoom:13,mapTypeControl:!0,mapTypeControlOptions:{mapTypeIds:["roadmap","satellite","hybrid","terrain","styled_map","midnight_map"]}}),map.mapTypes.set("styled_map",e),map.mapTypes.set("midnight_map",t),map.setMapTypeId("styled_map");var i=makeMarkerIcon("0091ff"),a=makeMarkerIcon("FFFF24");this.largeInfowindow=new google.maps.InfoWindow;for(var n=(new google.maps.LatLngBounds,0);n<locations.length;n++){var s=locations[n].location,r=locations[n].title,l=locations[n].content,p=locations[n].imgURL,g=locations[n].rating,c=locations[n].phone,m=new google.maps.Marker({position:s,title:r,content:l,animation:google.maps.Animation.DROP,icon:i,id:n,filterID:n,name:r,imgURL:p,rating:g,phone:"<p> Phone: "+c+"<p>"});markers.push(m),o.ricksPlaces.push(m),o.ricksPlaces()[n].marker=m,m.addListener("click",function(){populateInfoWindow(this,largeInfowindow)}),m.addListener("mouseover",function(){this.setIcon(a)}),m.addListener("mouseout",function(){this.setIcon(i)}),locationsLength=markers.length}};var appViewModel=new AppViewModel;ko.applyBindings(appViewModel);